<html>
  <html>
  <head>
    <meta charset="utf-8">
    <title>Nix Home-Manager path - My Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <script src="http://localhost:8080/static/js/main.js"></script>
    <link rel="stylesheet" href="http://localhost:8080/static/css/main.css" type="text/css" media="screen" />
    <style>
    </style>
  </head>

  <body style="display: flex;">
    <main style="width: 600px; margin: 0 auto; padding: 32px;">
      <div><section><p>Here are notes while trying to get home-manager setup for my environment, container or remote instances.</p><p>After a lot of fiddling with <code>nix</code> and <code>home-manager</code> installation, there are subtle differences and approaches that lead to the foresight of having a <code>reproducible, composable and reusable</code> environment.</p></section><h1 id="NIX">NIX</h1><h2 id="Installation: Single vs Multiple user">Installation: Single vs Multiple user</h2><section><p>While nix is part of multiple-user enviroment and it is prefered, multiple user installation might not be possible due to privileges such as in a shared linux/VM or inside a container, such as the LXD container used to test this repository.</p><p>Otherwise, for single-user installation, home-manager packages might conflict due to a priority error on the same package name. One solution is to set <code>nix</code> to a different priority level than <code>home-manager</code>.</p><pre class="example">nix-env set-flag --priority &lt;another_level&gt; nix
</pre></section><h2 id="Reproducible">Reproducible</h2><section><p>In order to keep track of the versions used, I identified 2 methods so far: <code>flake</code> and <code>niv</code>.</p><ul><li><p><code>niv</code> will keep track of the dependencies in <code>shell.nix</code> in <code>/nix/sources.json</code></p></li><li><p><code>flake</code> will similarly keep dependencies versions and hashes in <code>flake.lock</code></p></li></ul></section><h3 class="firn-TODO" id="Flake HM">Flake HM</h3><section><ul><li><p>[ ] Read about Flake</p></li><li><p>[ ] Flake shell.nix</p></li><li><p>[t] Flake for Home-Manager</p></li></ul></section><h2 id="Home-Manager">Home-Manager</h2><section><p>The official <a href="https://nix-community.github.io/home-manager/">Home-Manager Guide</a> provides an excelent resource for this, guiding through:</p><ul><li><p>install</p></li><li><p>switch, generations and rollbacks</p></li><li><p>XDG for integration with the DM</p></li><li><p>etc</p></li></ul><p>However, the above guide does not provide insight into implementation choices, but luckly
Nix has become quite popular and numerous blog posts can be found that talk about this and show their solutions:</p><ul><li><p><a href="https://www.bekk.christmas/post/2021/16/dotfiles-with-nix-and-home-manager">Declarative managment of dotfile with Nix</a></p></li><li><p><a href="https://www.lafuente.me/posts/installing-home-manager/">Custom HM in NixOS</a>: Represents a reproducible home-manager configuration</p></li><li><p><a href="https://github.com/ryantm/home-manager-template">home-manager-template</a></p></li><li><p>[ ] <a href="https://www.chrisportela.com/posts/home-manager-flake/">home-manager-flake</a>: Setting up dotfiles with home-manager as flake
  -- <a href="https://www.tweag.io/blog/2020-05-25-flakes/">Tutorial to flakes</a></p></li></ul></section><h3 id="Niv: run HM without installing it">Niv: run HM without installing it</h3><section><p><a href="https://github.com/ryantm/home-manager-template">home-manager-tempalte</a></p></section><h3 id="Flakes">Flakes</h3><section><p>It appears there might be some priority conflicts for HM using flake. Thist could be the same issue as the single install. The issue can be found here https://github.com/nix-community/home-manager/issues/2848</p></section><h3 id="Github Projects: HM + Flakes">Github Projects: HM + Flakes</h3><section><ul><li><p>https://github.com/the-nix-way/home-manager-config-template</p></li><li><p>https://github.com/Misterio77/nix-starter-configs</p></li><li><p>https://github.com/fufexan/dotfiles</p></li><li><p>https://github.com/MatthiasBenaets/nixos-config</p></li><li><p>https://github.com/MatthiasBenaets/nixos-config</p></li><li><p>https://github.com/lucperkins/nix-home-manager-config</p></li></ul></section><h2 id="fromYAML">fromYAML</h2><section><p>Bring in configuration from yaml file might be necesarry sometime (i.e. alacritty). There are 2 approaches to this:</p><ul><li><p>Convert <b>YAML</b> to <b>JSON</b> then use the <code class="src src-nix">importJSON</code> to import the JSON as an atrtribute: https://github.com/search?p=1&amp;q=fromYaml+language%3Anix&amp;type=Code</p></li></ul><ul><li><p>Alterntively we can link the conf file directly and not set the options in nix:<a href="https://github.com/gytis-ivaskevicius/nixfiles/blob/2b2abcd07ede0df56360a8cda50a919a65864f8c/overlays/g-alacritty/default.nix">call with explicit config file path</a>. This might also help with writing the conf file and have effect without having to produce a new derivation</p></li></ul></section><h1 id="Hosts">Hosts</h1><h2 id="LXD">LXD</h2><section><p>Nix uses some form of containers, sandbox or namespaces (which I don&apos;t know their underlying functionality), but in order for running nix isolated, it requires that nested containers are enabled for the host container. Configure it as follows:</p><pre class="example">lxc config set &lt;container_name&gt; security.nesting true
</pre></section></div>
    </main>

    <aside style="padding: 32px; width: 300px;">
     <section><ol><li><a href="#NIX">NIX</a></li><ol><li><a href="#Installation: Single vs Multiple user">Installation: Single vs Multiple user</a></li><li><a href="#Reproducible">Reproducible</a></li><ol><li><a href="#Flake HM">Flake HM</a></li></ol><li><a href="#Home-Manager">Home-Manager</a></li><ol><li><a href="#Niv: run HM without installing it">Niv: run HM without installing it</a></li><li><a href="#Flakes">Flakes</a></li><li><a href="#Github Projects: HM + Flakes">Github Projects: HM + Flakes</a></li></ol><li><a href="#fromYAML">fromYAML</a></li></ol><li><a href="#Hosts">Hosts</a></li><ol><li><a href="#LXD">LXD</a></li></ol></section>
      
  

      
  

      
  
    <section>
      <details open>
        <summary>Sitemap</summary>
        <ul>
          
            <li>
              <a href=http://localhost:8080/NixHM.html>Nix home-manager path
                
              </a>
            </li>
          
        </ul>
      </details>
    </section>
  

      
  

    </aside>
  </body>
</html>
